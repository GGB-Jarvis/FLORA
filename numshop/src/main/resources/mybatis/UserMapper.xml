<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE  mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.num.shop.mapper.UserMapper">
    <resultMap id="BaseResultMap" type="com.num.shop.entity.User">
        <result column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="realname" property="realname"/>
        <result column="openid" property="openid"/>
        <result column="imageurl" property="imageurl"/>
        <result column="name" property="name"/>
        <result column="phone" property="phone"/>
        <result column="cardno" property="cardno"/>
        <result column="authentication" property="authentication"/>
        <result column="registertime" property="registertime"/>
        <result column="authenticationtime" property="authenticationtime"/>
        <result column="reserved" property="reserved"/>
        <result column="blockpassword" property="blockpassword"/>
        <result column="privateKey" property="privateKey"></result>
        <result column="address" property="address"></result>
    </resultMap>

    <resultMap id="rankMap" type="com.num.shop.entity.Ranking">
        <result column="count" property="count"></result>
        <result column="code" property="code"></result>
        <association property="user" column="code" select="com.num.shop.mapper.UserMapper.selectByCode"></association>
    </resultMap>

    <!-- 表字段 -->
    <sql id="baseColumns">
         t.id
        , t.username
        , t.password
        , t.realname
        , t.openid
        , t.imageurl
        , t.name
        , t.phone
        , t.cardno
        , t.authentication
        , t.registertime
        , t.authenticationtime
        , t.reserved
        , t.blockpassword
        , t.privateKey
        , t.address
        </sql>
    <select id="selectByCode" resultMap="BaseResultMap" parameterType="string">
        select
        <include refid="baseColumns"/>
        FROM user t
        where reserved2 = #{value}
    </select>
    <!-- 查询全部 -->
    <select id="listAll" resultMap="BaseResultMap" parameterType="com.num.shop.entity.User">
        SELECT
        <include refid="baseColumns"/>
        FROM user t
        <where>
            <if test="username!=null and username!=''">
                and username = #{username}
            </if>
            <if test="password!=null and password!=''">
                and password = #{password}
            </if>
            <if test="realname!=null and realname!=''">
                and realname = #{realname}
            </if>
            <if test="openid!=null and openid!=''">
                and openid = #{openid}
            </if>
            <if test="imageurl!=null and imageurl!=''">
                and imageurl = #{imageurl}
            </if>
            <if test="name!=null and name!=''">
                and name = #{name}
            </if>
            <if test="phone!=null and phone!=''">
                and phone = #{phone}
            </if>
            <if test="cardno!=null and cardno!=''">
                and cardno = #{cardno}
            </if>
            <if test="authentication!=null and authentication!=''">
                and authentication = #{authentication}
            </if>
            <if test="registertime!=null and registertime!=''">
                and registertime = #{registertime}
            </if>
            <if test="authenticationtime!=null and authenticationtime!=''">
                and authenticationtime = #{authenticationtime}
            </if>
            <if test="reserved!=null and reserved!=''">
                and reserved = #{reserved}
            </if>
            <if test="blockpassword!=null and blockpassword!=''">
                and blockpassword = #{blockpassword}
            </if>
            <if test="privateKey!=null and privateKey!=''">
                and privateKey = #{privateKey}
            </if>
            <if test="address!=null and address!=''">
                and address = #{address}
            </if>
        </where>
        order by id desc
        <if test="start!=null and pageSize !=0 ">
            limit #{start} , #{pageSize}
        </if>
    </select>
    <!-- 查询全部记录数量 -->
    <select id="total" resultType="int" parameterType="com.num.shop.entity.User">
        SELECT
        count(1)
        FROM user t
        <where>
            <if test="username!=null and username!=''">
                and username = #{username}
            </if>
            <if test="password!=null and password!=''">
                and password = #{password}
            </if>
            <if test="realname!=null and realname!=''">
                and realname = #{realname}
            </if>
            <if test="openid!=null and openid!=''">
                and openid = #{openid}
            </if>
            <if test="imageurl!=null and imageurl!=''">
                and imageurl = #{imageurl}
            </if>
            <if test="name!=null and name!=''">
                and name = #{name}
            </if>
            <if test="phone!=null and phone!=''">
                and phone = #{phone}
            </if>
            <if test="cardno!=null and cardno!=''">
                and cardno = #{cardno}
            </if>
            <if test="authentication!=null and authentication!=''">
                and authentication = #{authentication}
            </if>
            <if test="registertime!=null and registertime!=''">
                and registertime = #{registertime}
            </if>
            <if test="authenticationtime!=null and authenticationtime!=''">
                and authenticationtime = #{authenticationtime}
            </if>
            <if test="reserved!=null and reserved!=''">
                and reserved = #{reserved}
            </if>
            <if test="blockpassword!=null and blockpassword!=''">
                and blockpassword = #{blockpassword}
            </if>
            <if test="privateKey!=null and privateKey!=''">
                and privateKey = #{privateKey}
            </if>
            <if test="address!=null and address!=''">
                and address = #{address}
            </if>
        </where>
    </select>
    <!-- 根据主键获取单条记录 -->
    <select id="getById" resultMap="BaseResultMap" parameterType="Integer">
        SELECT
        <include refid="baseColumns"/>
        FROM user t
        WHERE id = #{id}
    </select>
    <select id="findRanking" resultMap="rankMap">
        select count(1) as `count`,reserved4 as code from user where reserved4 is not null group by reserved4 limit 10
    </select>

    <select id="getByOpenId" resultMap="BaseResultMap" parameterType="string">
        SELECT
        <include refid="baseColumns"/>
        FROM user t
        WHERE openid = #{value} and phone is null
    </select>
    <select id="getByPhone" resultMap="BaseResultMap" parameterType="string">
        SELECT
        <include refid="baseColumns"/>
        FROM user t
        WHERE phone = #{value}
    </select>

    <!-- 插入全部字段 -->
    <insert id="insert" parameterType="com.num.shop.entity.User"
            keyProperty="id" keyColumn="id" useGeneratedKeys="true"
    >
        INSERT INTO user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            username,
            password,
            realname,
            openid,
            imageurl,
            name,
            phone,
            cardno,
            authentication,
            registertime,
            authenticationtime,
            reserved,
            blockpassword,
            privateKey,
            address,
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            #{username},
            #{password},
            #{realname},
            #{openid},
            #{imageurl},
            #{name},
            #{phone},
            #{cardno},
            #{authentication},
            #{registertime},
            #{authenticationtime},
            #{reserved},
            #{blockpassword},
            #{privateKey},
            #{address},
        </trim>
    </insert>

    <!-- 插入不为NULL的字段 -->
    <insert id="insertIgnoreNull" parameterType="com.num.shop.entity.User"
            keyProperty="id" keyColumn="id" useGeneratedKeys="true"
    >
        INSERT INTO user
        <trim prefix="(" suffix=")" suffixOverrides=",">

            <if test="username != null  and username!=''">
                username,
            </if>
            <if test="password != null  and password!=''">
                password,
            </if>
            <if test="realname != null  and realname!=''">
                realname,
            </if>
            <if test="openid != null  and openid!=''">
                openid,
            </if>
            <if test="imageurl != null  and imageurl!=''">
                imageurl,
            </if>
            <if test="name != null  and name!=''">
                name,
            </if>
            <if test="phone != null  and phone!=''">
                phone,
            </if>
            <if test="cardno != null  and cardno!=''">
                cardno,
            </if>
            <if test="authentication != null  and authentication!=''">
                authentication,
            </if>
            <if test="registertime != null  and registertime!=''">
                registertime,
            </if>
            <if test="authenticationtime != null  and authenticationtime!=''">
                authenticationtime,
            </if>
            <if test="reserved != null  and reserved!=''">
                reserved,
            </if>
            <if test="blockpassword != null  and blockpassword!=''">
                blockpassword,
            </if>
            <if test="privateKey != null  and privateKey!=''">
                privateKey,
            </if>
            <if test="address != null  and address!=''">
                address,
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="username != null  and username!=''">
                #{username},
            </if>
            <if test="password != null  and password!=''">
                #{password},
            </if>
            <if test="realname != null  and realname!=''">
                #{realname},
            </if>
            <if test="openid != null  and openid!=''">
                #{openid},
            </if>
            <if test="imageurl != null  and imageurl!=''">
                #{imageurl},
            </if>
            <if test="name != null  and name!=''">
                #{name},
            </if>
            <if test="phone != null  and phone!=''">
                #{phone},
            </if>
            <if test="cardno != null  and cardno!=''">
                #{cardno},
            </if>
            <if test="authentication != null  and authentication!=''">
                #{authentication},
            </if>
            <if test="registertime != null  and registertime!=''">
                #{registertime},
            </if>
            <if test="authenticationtime != null  and authenticationtime!=''">
                #{authenticationtime},
            </if>
            <if test="reserved != null  and reserved!=''">
                #{reserved},
            </if>
            <if test="blockpassword != null  and blockpassword!=''">
                #{blockpassword},
            </if>
            <if test="privateKey != null  and privateKey!=''">
                #{privateKey},
            </if>
            <if test="address != null  and address!=''">
                #{address},
            </if>
        </trim>
    </insert>

    <!-- 更新,更新全部字段 -->
    <update id="update" parameterType="com.num.shop.entity.User">
        UPDATE user
        <set>
            username=#{username},
            password=#{password},
            realname=#{realname},
            openid=#{openid},
            imageurl=#{imageurl},
            name=#{name},
            phone=#{phone},
            cardno=#{cardno},
            authentication=#{authentication},
            registertime=#{registertime},
            authenticationtime=#{authenticationtime},
            reserved=#{reserved},
            blockpassword=#{blockpassword},
            privateKey=#{privateKey},
            address=#{address},
        </set>
        WHERE id = #{id}
    </update>

    <update id="updatePass" parameterType="com.num.shop.entity.User">
    update user set password = #{password} where phone = #{phone}
</update>

    <!-- 更新不为NULL的字段 -->
    <update id="updateIgnoreNull" parameterType="com.num.shop.entity.User">
        UPDATE user
        <set>
            <if test="username != null  and username!=''">
                username=#{username},
            </if>
            <if test="password != null  and password!=''">
                password=#{password},
            </if>
            <if test="realname != null  and realname!=''">
                realname=#{realname},
            </if>
            <if test="openid != null  and openid!=''">
                openid=#{openid},
            </if>
            <if test="imageurl != null  and imageurl!=''">
                imageurl=#{imageurl},
            </if>
            <if test="name != null  and name!=''">
                name=#{name},
            </if>
            <if test="phone != null  and phone!=''">
                phone=#{phone},
            </if>
            <if test="cardno != null  and cardno!=''">
                cardno=#{cardno},
            </if>
            <if test="authentication != null  and authentication!=''">
                authentication=#{authentication},
            </if>
            <if test="registertime != null  and registertime!=''">
                registertime=#{registertime},
            </if>
            <if test="authenticationtime != null  and authenticationtime!=''">
                authenticationtime=#{authenticationtime},
            </if>
            <if test="reserved != null  and reserved!=''">
                reserved=#{reserved},
            </if>
            <if test="blockpassword != null  and blockpassword!=''">
                blockpassword=#{blockpassword},
            </if>
            <if test="privateKey != null  and privateKey!=''">
                privateKey=#{privateKey},
            </if>
            <if test="address != null  and address!=''">
                address=#{address},
            </if>
        </set>
        WHERE id = #{id}
    </update>


    <!-- 根据主键删除记录 -->
    <delete id="delete" parameterType="com.num.shop.entity.User">
		DELETE FROM user
		WHERE id = #{id}
	</delete>


</mapper>