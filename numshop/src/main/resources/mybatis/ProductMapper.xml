<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE  mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.num.shop.mapper.ProductMapper">
    <resultMap id="BaseResultMap" type="com.num.shop.entity.Product">
        <result column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="count" property="count"/>
        <result column="imageurl" property="imageurl"/>
        <result column="otherurl" property="otherurl"/>
        <result column="tag" property="tag"/>
        <result column="createtime" property="createtime"/>
        <result column="shoptime" property="shoptime"/>
        <result column="userid" property="userid"/>
        <result column="price" property="price"/>
        <result column="isdelete" property="isdelete"/>

<!--        <result column="author" property="author"/>-->
<!--        <result column="authorDesc" property="authorDesc"/>-->
<!--        <result column="description" property="description"/>-->
        <result column="tokenId" property="tokenId"/>
        <association property="user" column="userid" select="com.num.shop.mapper.UserMapper.getById"></association>
    </resultMap>

    <!-- 表字段 -->
    <sql id="baseColumns">
         t.id
        , t.name
        , t.count
        , t.imageurl
        , t.otherurl
        , t.tag
        , t.createtime
        , t.shoptime
        , t.userid
        , t.price
        , t.isdelete
        , t.description
        , t.tokenId
        </sql>

    <!-- 查询全部 -->
    <select id="listAll" resultMap="BaseResultMap" parameterType="com.num.shop.entity.Product">
        SELECT
        <include refid="baseColumns"/>
        FROM product t
        <where>
            <if test="name!=null and name!=''">
                and name = #{name}
            </if>
            <if test="count!=null and count!=''">
                and count = #{count}
            </if>
            <if test="imageurl!=null and imageurl!=''">
                and imageurl = #{imageurl}
            </if>
            <if test="otherurl!=null and otherurl!=''">
                and otherurl = #{otherurl}
            </if>
            <if test="tag!=null and tag!=''">
                and tag = #{tag}
            </if>
            <if test="createtime!=null and createtime!=''">
                and createtime = #{createtime}
            </if>
            <if test="shoptime!=null and shoptime!=''">
                and shoptime = #{shoptime}
            </if>
            <if test="userid!=null and userid!=''">
                and userid = #{userid}
            </if>
            <if test="price!=null and price!=''">
                and price = #{price}
            </if>
            <if test="isdelete!=null and isdelete!=''">
                and isdelete = #{isdelete}
            </if>
            <if test="status=='热卖商品'">
                and shoptime &lt; now()
            </if>
            <if test="status=='即将发售'">
                and shoptime >= now()
            </if>
            <if test="description!=null and description!=''">
                and description = #{description}
            </if>
            <if test="tokenId!=null and tokenId!=''">
                and tokenId = #{tokenId}
            </if>
        </where>
        order by id desc
        <if test="start!=null and pageSize !=0 ">
            limit #{start} , #{pageSize}
        </if>
    </select>
    <!-- 查询全部记录数量 -->
    <select id="total" resultType="int" parameterType="com.num.shop.entity.Product">
        SELECT
        count(1)
        FROM product t
        <where>
            <if test="name!=null and name!=''">
                and name = #{name}
            </if>
            <if test="count!=null and count!=''">
                and count = #{count}
            </if>
            <if test="imageurl!=null and imageurl!=''">
                and imageurl = #{imageurl}
            </if>
            <if test="otherurl!=null and otherurl!=''">
                and otherurl = #{otherurl}
            </if>
            <if test="tag!=null and tag!=''">
                and tag = #{tag}
            </if>
            <if test="createtime!=null and createtime!=''">
                and createtime = #{createtime}
            </if>
            <if test="shoptime!=null and shoptime!=''">
                and shoptime = #{shoptime}
            </if>
            <if test="userid!=null and userid!=''">
                and userid = #{userid}
            </if>
            <if test="price!=null and price!=''">
                and price = #{price}
            </if>
            <if test="isdelete!=null and isdelete!=''">
                and isdelete = #{isdelete}
            </if>
            <if test="description!=null and description!=''">
                and description = #{description}
            </if>
            <if test="tokenId!=null and tokenId!=''">
                and tokenId = #{tokenId}
            </if>
        </where>
    </select>
    <!-- 根据主键获取单条记录 -->
    <select id="getById" resultMap="BaseResultMap" parameterType="Integer">
        SELECT
        <include refid="baseColumns"/>
        FROM product t
        WHERE id = #{id}
    </select>

    <!-- 插入全部字段 -->
    <insert id="insert" parameterType="com.num.shop.entity.Product"
            keyProperty="id" keyColumn="id" useGeneratedKeys="true"
    >
        INSERT INTO product
        <trim prefix="(" suffix=")" suffixOverrides=",">
            name,
            count,
            imageurl,
            otherurl,
            tag,
            createtime,
            shoptime,
            userid,
            price,
            isdelete,
            description,
            tokenId,
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            #{name},
            #{count},
            #{imageurl},
            #{otherurl},
            #{tag},
            #{createtime},
            #{shoptime},
            #{userid},
            #{price},
            #{isdelete},
            #{description},
            #{tokenId},
        </trim>
    </insert>

    <!-- 插入不为NULL的字段 -->
    <insert id="insertIgnoreNull" parameterType="com.num.shop.entity.Product"
            keyProperty="id" keyColumn="id" useGeneratedKeys="true"
    >
        INSERT INTO product
        <trim prefix="(" suffix=")" suffixOverrides=",">

            <if test="name != null  and name!=''">
                name,
            </if>
            <if test="count != null  and count!=''">
                count,
            </if>
            <if test="imageurl != null  and imageurl!=''">
                imageurl,
            </if>
            <if test="otherurl != null  and otherurl!=''">
                otherurl,
            </if>
            <if test="tag != null  and tag!=''">
                tag,
            </if>
            <if test="createtime != null  and createtime!=''">
                createtime,
            </if>
            <if test="shoptime != null  and shoptime!=''">
                shoptime,
            </if>
            <if test="userid != null  and userid!=''">
                userid,
            </if>
            <if test="price != null  and price!=''">
                price,
            </if>
            <if test="isdelete != null  and isdelete!=''">
                isdelete,
            </if>
            <if test="description != null  and description!=''">
                description,
            </if>
            <if test="tokenId != null  and tokenId!=''">
                tokenId,
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="name != null  and name!=''">
                #{name},
            </if>
            <if test="count != null  and count!=''">
                #{count},
            </if>
            <if test="imageurl != null  and imageurl!=''">
                #{imageurl},
            </if>
            <if test="otherurl != null  and otherurl!=''">
                #{otherurl},
            </if>
            <if test="tag != null  and tag!=''">
                #{tag},
            </if>
            <if test="createtime != null  and createtime!=''">
                #{createtime},
            </if>
            <if test="shoptime != null  and shoptime!=''">
                #{shoptime},
            </if>
            <if test="userid != null  and userid!=''">
                #{userid},
            </if>
            <if test="price != null  and price!=''">
                #{price},
            </if>
            <if test="isdelete != null  and isdelete!=''">
                #{isdelete},
            </if>
            <if test="description != null  and description!=''">
                #{description},
            </if>
            <if test="tokenId != null  and tokenId!=''">
                #{tokenId},
            </if>
        </trim>
    </insert>

    <!-- 更新,更新全部字段 -->
    <update id="update" parameterType="com.num.shop.entity.Product">
        UPDATE product
        <set>
            name=#{name},
            count=#{count},
            imageurl=#{imageurl},
            otherurl=#{otherurl},
            tag=#{tag},
            createtime=#{createtime},
            shoptime=#{shoptime},
            userid=#{userid},
            price=#{price},
            isdelete=#{isdelete},
            description=#{description},
            tokenId=#{tokenId},
        </set>
        WHERE id = #{id}
    </update>


    <!-- 更新不为NULL的字段 -->
    <update id="updateIgnoreNull" parameterType="com.num.shop.entity.Product">
        UPDATE product
        <set>
            <if test="name != null  and name!=''">
                name=#{name},
            </if>
            <if test="count != null  and count!=''">
                count=#{count},
            </if>
            <if test="imageurl != null  and imageurl!=''">
                imageurl=#{imageurl},
            </if>
            <if test="otherurl != null  and otherurl!=''">
                otherurl=#{otherurl},
            </if>
            <if test="tag != null  and tag!=''">
                tag=#{tag},
            </if>
            <if test="createtime != null  and createtime!=''">
                createtime=#{createtime},
            </if>
            <if test="shoptime != null  and shoptime!=''">
                shoptime=#{shoptime},
            </if>
            <if test="userid != null  and userid!=''">
                userid=#{userid},
            </if>
            <if test="price != null  and price!=''">
                price=#{price},
            </if>
            <if test="isdelete != null  and isdelete!=''">
                isdelete=#{isdelete},
            </if>
            <if test="description != null  and description!=''">
                description=#{description},
            </if>
            <if test="tokenId != null  and tokenId!=''">
                tokenId=#{tokenId},
            </if>
        </set>
        WHERE id = #{id}
    </update>


    <!-- 根据主键删除记录 -->
    <delete id="delete" parameterType="com.num.shop.entity.Product">
		update product set isdelete = '2' where id = #{id}
	</delete>


</mapper>